# default for version of terraform & provider name
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 4.16"
    }
  }

  required_version = ">= 1.2.0"
}

# Providers Configuration
provider "aws" {
  region     = "us-west-2"
  access_key = "AKIAYHJANNQ3EXQXFH4V" # give your access_key insteed
  secret_key = "XPmytlI6g81HxomI4l1FLL//YtrnLejcSlpn8O/k" # give your secret_key insteed
}

# Create a Security Group
resource "aws_security_group" "example" {
  name = "example-sg"

  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"] # Allow SSH access from anywhere (update for security)
  }

  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"] # Allow HTTP access from anywhere
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}

# create a keypair for ssh clint

# Launch an EC2 Instance
# create a EC2 instance
resource "aws_instance" "server" { # "myvm" give your EC2 instance name insteed "this is for your reference"
 ami           = "ami-05d38da78ce859165" # us-west-2 instance id for (UBUNTU linux)
 instance_type = "t2.micro"
 security_groups = [aws_security_group.example.name]
 key_name = "mykey" # "TF_key" change your public name here

 tags = {
    Name = "my-ec2-machines"    
  }
}

resource "aws_key_pair" "mykey" {
  key_name   = "mykey"
  public_key = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDVO2tBp/dVn5S22rHSTN4mfLTAM+e6yNzYv5baWFP1303AA2nxA+84LOltTdO4rDCKlloqfGv7fI54Ikf48iRS1hsYXhQe6DLcrjOQe2QrOMCJQoG58RmvIK7DzOmsjzlqYLRt6Uc06NrETJ6YaUIPqfCugw+iSnOO+zVcC/mIsTcYhWO3qfkBEohTk0ZD2SONVxCKauUTUzobW5Xab0tNZ+JJ9j0Yq5dADYTuKx9hzjiJinTzeOrqxnkEB8RlIVNxVkEm4AW9L/Y13E9FzplAfRzaa8d2oo370Clcsr8gzGsM7np+xnviBIIXMWiKMOWXvh8L5s6lmzfazFP7n3aKzeclj6lhu7XE/FT4eFbsPk6oDB7iqRbYNylh/g4WOyTm70aIevqPbu34o52uw8mLFnCbhI4Ok6o/1+qm4WjVSAG1K2qavpgg15pjVVk+5jRF0jkNg15Xw14YQcXQuTMPEi9bC+e7NjWVhDk8ioLqq7ekd9hXzXGe2H/KPpQ3Otw5n7SlXS/ZOsRc3OagIde+/CFdx9cOaiLb4630ZzT/czGcaQuIclFh4OWP7eKmd3Amm/+jbj5ryLuot09Mf3InkObABdyoVYcQC2Iii0TukFRkqPhkFmgBoNTSOjvrAokMr1rANDMmCZj+lZdVfPW9ZdsSFlRUc5JRGDj/2oQhbQ== pdiva@DESKTOP-GEEOPHN" # this is from public key document using commond (ssh-keygen -t rsa -b 4096)
}
